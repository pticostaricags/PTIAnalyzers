# PTIAnalyzers
This package allows you to get some insights on sentiment and personality based on a given text. Package requires you to have credentials for Azure Text Analytics and IBM Personality Insights

## Usage Research
Please let us know how you will use this package in order to make it better for you: https://www.surveymonkey.com/r/68TG9G8

## Non-Developers
A Windows Tool will be hosted and frequently updated for demo purposes. Currently it only supports analyze a given text and save the generated excel file.
Download and unzip the file "PTI Analyzer Win Client.zip"

## Developers
## Pre- Requirements
In order to be able to use the package, you need to have the following
* Azure Text Analytics. 
  * You can learn how to configure one here: https://docs.microsoft.com/en-us/azure/cognitive-services/cognitive-services-apis-create-account
  * Get the access key and endpoint url https://docs.microsoft.com/en-us/azure/cognitive-services/text-analytics/how-tos/text-analytics-how-to-access-key
* IBM Personality Insights
  * You can learn how to create an account here: https://cloud.ibm.com/docs/services/personality-insights?topic=personality-insights-gettingStarted#gettingStarted
  * Get the username and password https://cloud.ibm.com/docs/services/watson?topic=watson-creating-credentials#creating-credentials
  

## Analyze a given text
* Install the package https://www.nuget.org/packages/PTI.Analyzers/
* Create a new instance of TextAnalyzer and pass it the configured parameters.
* If you want to intercept the http responses received, configure the event handler for OnHttpResponseReceivedEventHandler
* Create a new instance of DataAnalyzer
* Invoke "AnalyzeTextAndGenerateExcelFileAsync". It will return a byte[] corresponding to the generated XLSX file.
* Do whatever you need to do with the generated bytes, such as save it to disk.

               TextAnalyzer textAnalyzer = new TextAnalyzer(new MSTextAnalyticsConfiguration(Configuration.MSTextAnalyticsKey,
                    Configuration.MSTextAnalyticsEndpoint),
                    new IBMWatsonClientConfiguration(Configuration.IBMPersonalityInsightsUsername,
                    Configuration.IBMPersonalityInsightsPassword));
            textAnalyzer.OnHttpResponseReceivedEventHandler += TextAnalyzer_OnHttpResponseReceivedEventHandler;
            DataAnalyzer dataAnalyzer =
                new DataAnalyzer(
                    textAnalyzer);
            var excelFileBytes = dataAnalyzer.AnalyzeTextAndGenerateExcelFileAsync(fileContents).Result;
            File.WriteAllBytes(@"C:\Temp\GeneratedExcelFile.xlsx", excelFileBytes);
            
## Analyze a list of photos and generates temp files and byte[] with the modified image including the faces rectangles
* Requires having credentials for Azure Face API and Computer Vision
* Check Face API here https://docs.microsoft.com/en-us/azure/cognitive-services/face/overview
* Check Computer Vision here https://docs.microsoft.com/en-us/azure/cognitive-services/computer-vision/home
               
               PhotoAnalyzer photoAnalyzer = new PhotoAnalyzer(new MSFaceApiConfiguration(
                FACEKEY, FACEENDPOINT),
                new MSComputerVisionApiConfiguration(VISIONKEY,
                VISIONENDPOINT));
            DataAnalyzer dataAnalyzer = new DataAnalyzer(
                photoAnalyzer);
            List<PhotoInformation> lstPhotos = new List<PhotoInformation>();
            string testFile = @"C:\TestFilesDirectory\testFile.jpg";
            lstPhotos.Add(new PhotoInformation()
            {
                Filename = testFile,
                PhotoStream = File.OpenRead(testFile)
            });
            await dataAnalyzer.AnalyzePhotoStream(lstPhotos, Color.Blue, 10, @"C:\Temp\GeneratedFiles");
            foreach (var singlePhoto in lstPhotos)
            {
                var filenameWithoutPath = System.IO.Path.GetFileName(singlePhoto.Filename);
                var newFileFullPath = $@"C:\Temp\ModifiedPhoto{filenameWithoutPath}";
                File.WriteAllBytes(newFileFullPath, singlePhoto.ModifiedPhotoBytes);
            }

## Analyze an excel file and retrieve a modified copy including per row sentiment, personality information and sentiment over time chart
                TextAnalyzer textAnalyzer =
                new TextAnalyzer(new MSTextAnalyticsConfiguration("REPLACE WITH KEY",
                          "REPLACE WITH ENDPOINT"),
                          new IBMWatsonClientConfiguration("REPLACE WITH USERNAME",
                          "REPLACE WITH PASSWORD"));
            AnalyzeAndDownloadExcelFileParameters parameters =
            new AnalyzeAndDownloadExcelFileParameters()
            {
                ColumnNameForSentimentResults = "Sentiment",
                ColumnToAnalyze = "Description",
                ColumnWithDate = "ItemDate",
                ColumnWithUniqueId = "UniqueId",
                WorkSheetName = "Sheet1"
            };
            using (var fileStream =
                File.OpenRead(@"REPLACE WITH LOCATION OF .XLSX FILE"))
            {
                using (MemoryStream memStream = new MemoryStream())
                {
                    fileStream.CopyTo(memStream);
                    byte[] fileContents = memStream.ToArray();
                    DataAnalyzer dataAnalyzer = new DataAnalyzer(textAnalyzer);
                    var outputFileContents = dataAnalyzer.AnalyzeAndModifyExcelFile(parameters,
                    fileContents, memStream).Result;
                    File.WriteAllBytes(@"REPLACE WITH FULL PATH FOR RESULTING .XLSX FILE", outputFileContents);
                }
            }
            
## Analyze User Tweets
                LinqToTwitter.SingleUserAuthorizer singleUserAuthorizer =
                new LinqToTwitter.SingleUserAuthorizer()
                {
                    CredentialStore = new LinqToTwitter.SingleUserInMemoryCredentialStore()
                    {
                        ConsumerKey = "REPLACE WITH YOUR TWITTER APP CONSUMER KEY",
                        ConsumerSecret = "REPLACE WITH YOUR TWITTER APP CONSUMER SECRET",
                        AccessToken = "REPLACE WITH YOUR TWITTER APP ACCESS TOKEN",
                        AccessTokenSecret = "REPLACE WITH YOUR TWITTER APP ACCESS TOKEN",
                        ScreenName = "REPLACE WITH YOUR username"
                    }
                };
            TextAnalyzer textAnalyzer =
                new TextAnalyzer(MSTextAnalyticsConfiguration,
                          IBMWatsonClientConfiguration);
            DataAnalyzer dataAnalyzer = new DataAnalyzer(singleUserAuthorizer, textAnalyzer);
            var result = await dataAnalyzer.AnalyzeUserTweetsAndGenerateExcelFileAsync("REPLACE WITH USER HANDLE TO ANALYZE");
            File.WriteAllBytes(@"REPLACE WITH THE DESIRED .XLSX FILE FULL PATH", result);
